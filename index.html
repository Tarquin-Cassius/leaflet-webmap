<!DOCTYPE html>
<html lang="sv">
    <head>
        <title>Karta</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <script src="icons.js"></script>
        <script src="https://unpkg.com/leaflet-ant-path/dist/leaflet-ant-path.js"></script>

        <!--stulet från https://leafletjs.com/examples/mobile/example.html--> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <style> 
            html, body {
                height: 100%;
                margin: 0;
            }
            .leaflet-container {
                height: 400px;
                width: 600px;
                max-width: 100%;
                max-height: 100%;
            }
            .menu-button {
                position: absolute;
                top: 10px;
                right: 10px;
                background: white;
                border: 1px solid #ccc;
                padding: 10px;
                border-radius: 5px;
                cursor: pointer;
                z-index: 1000;
            }
            .menu-dropdown {
                position: absolute;
                top: 10px;
                right: 75px;
                background: white;
                border: 1px solid #ccc;
                padding: 10px;
                border-radius: 5px;
                display: block; 
                z-index: 1000;
            }
            #map {
                height: 100%; 
                width: 100vw; 
            }
        </style>
    </head>
    <body>
        <div id="map"></div>

        <!-- Menyknapp -->
        <div class="menu-button" id="menuButton">
            <img src="icons/menu.png" alt="Menu" style="width: 40px; height: 40px;" />
        </div>

        <!-- Dropdown Meny -->
        <div class="menu-dropdown" id="menuDropdown">
            Filter:<br>
            <button id="checkAllButton">Markera alla</button>
            <button id="uncheckAllButton">Avmarkera alla</button><br>
            <label>
                <input type="checkbox" id="toggleMarkers" checked> Lägerbålsplatser
            </label><br>
            <label>
                <input type="checkbox" id="toggleBSTT" checked> BSTT
            </label><br>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Kartans initialkoordinater (Lillgårn)
                var initialCoordinates = [60.25542, 18.69360];

                // Skapar kartan med restriktioner på zoom -->
                var lfmap = L.map('map', {
                    center: initialCoordinates,
                    zoom: 14,
                    minZoom: 13
                });

                // Definera kartans gränser (en bit utanför VÖ, Garpen, Bodskären)-->
                var southWest = L.latLng(60.2425, 18.6438);
                var northEast = L.latLng(60.2995, 18.7568); 
                var bounds = L.latLngBounds(southWest, northEast);
                lfmap.setMaxBounds(bounds);
                lfmap.on('drag', function() {
                    lfmap.panInsideBounds(bounds, {animate: true});
                })

                // Lägg till OSM-lager -->
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                }).addTo(lfmap);

                // Hämta kartikoner för lägerbålsplatser -->
                var campfiresiteMarkers = [];
                fetch('campfiresites.json')
                .then(response => response.json())
                .then(locations => {
                    locations.forEach(function(location) {
                        var marker = L.marker([location.lat, location.lng], {icon: getIcon(location.type)})
                        marker.bindPopup("<b>" + location.name + "</b><br>" + location.description);
                        marker.addTo(lfmap);
                        campfiresiteMarkers.push(marker);
                    });
                    // Visa/göm ikoner -->
                    document.getElementById("toggleMarkers").addEventListener("change", function() {
                        var isChecked = this.checked;
                        campfiresiteMarkers.forEach(marker => {
                            if (isChecked) {
                                marker.addTo(lfmap);
                            } else {
                                lfmap.removeLayer(marker);
                            }
                        });
                    });
                })

                // Skapa stig
                var startMarker, endMarker, polyline;
                fetch('bstt.json')
                .then(response => response.json())
                .then(data => {
                    if (data.trailinfo && data.start && data.end && data.path) {
                        var startMarker = L.marker([data.start.lat, data.start.lng], {icon: icons.startIcon});
                        startMarker.bindPopup("<b>" + data.trailinfo.name + "</b><br>" + data.start.description);
                        startMarker.addTo(lfmap);

                        var endMarker = L.marker([data.end.lat, data.end.lng], {icon: icons.finishIcon});
                        endMarker.bindPopup("<b>" + data.trailinfo.name + "</b><br>" + data.end.description);
                        endMarker.addTo(lfmap);

                        var polyline = L.polyline(data.path, {
                            color: 'pink',
                            weight: 10,
                            opacity: 0.8
                        })
                        polyline.addTo(lfmap);

                        document.getElementById("toggleBSTT").addEventListener("change", function() {
                            if (startMarker && endMarker && polyline) {
                                if (this.checked) {
                                    startMarker.addTo(lfmap);
                                    endMarker.addTo(lfmap);
                                    polyline.addTo(lfmap);
                                } else {
                                    lfmap.removeLayer(startMarker);
                                    lfmap.removeLayer(endMarker);
                                    lfmap.removeLayer(polyline);
                                }
                             }
                        });
                        document.getElementById("uncheckAllButton").addEventListener("click", function() {
                            var checkboxes = document.querySelectorAll('#menuDropdown input[type="checkbox"]');
                            checkboxes.forEach(checkbox => checkbox.checked = false);
                            lfmap.removeLayer(startMarker);
                            lfmap.removeLayer(endMarker);
                            lfmap.removeLayer(polyline);
                            campfiresiteMarkers.forEach(marker => lfmap.removeLayer(marker));
                        });
                        document.getElementById("checkAllButton").addEventListener("click", function() {
                            var checkboxes = document.querySelectorAll('#menuDropdown input[type="checkbox"]');
                            checkboxes.forEach(checkbox => checkbox.checked = true);
                            lfmap.addLayer(startMarker);
                            lfmap.addLayer(endMarker);
                            lfmap.addLayer(polyline);
                            campfiresiteMarkers.forEach(marker => lfmap.addLayer(marker));
                        });
                    }
                })
                .catch(error => console.error("Error fetching path data:", error));


                
                // Meny klick -->
                document.getElementById("menuButton").addEventListener("click", function() {
                    var dropdown = document.getElementById("menuDropdown");
                    dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
                });

                
            })  
        </script>
    </body>
</html>
